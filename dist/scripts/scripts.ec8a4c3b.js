"use strict";angular.module("blogApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngStorage","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/blogs/:blogId",{templateUrl:"views/blog.html",controller:"BlogCtrl"}).when("/blogs/:blogId/posts/:postId",{templateUrl:"views/blogPost.html",controller:"BlogPostCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"AuthCtrl"}).when("/logout",{templateUrl:"views/login.html",controller:"AuthCtrl"}).when("/createBlog",{templateUrl:"views/createBlog.html",controller:"BlogCtrl"}).when("/newPost",{templateUrl:"views/createPost.html",controller:"NewBlogPostCtrl"}).otherwise({redirectTo:"/"})}]).controller("IndexCtrl",["$scope","$localStorage","$location",function(a,b,c){a.isLoggedIn=function(){return b.currentUser?!0:!1},a.logout=function(){b.$reset(),c.path("/blogs")},a.switchStyle=function(){"navbar-inverse"==a.navbarStyle?a.navbarStyle="navbar-default":a.navbarStyle="navbar-inverse"},a.itemClicked=function(b){a.selectedIndex=b},a.style=!0,a.navbarStyle="navbar-inverse",a.homeBarState="active",a.createBlogState="",a.addPostState="",a.makeHomeActive=function(){a.homeBarState="active",a.createBlogState="",a.addPostState=""},a.makeCreateBlogActive=function(){a.homeBarState="",a.createBlogState="active",a.addPostState=""},a.makeAddPostActive=function(){a.homeBarState="",a.createBlogState="",a.addPostState="active"}}]),angular.module("blogApp").controller("MainCtrl",["$scope","$http","$localStorage",function(a,b,c){b({method:"GET",url:"/api/index.php/blogs"}).success(function(b){a.blogs=b})}]),angular.module("blogApp").controller("BlogCtrl",["$scope","$http","$routeParams","$location","$localStorage",function(a,b,c,d,e){b({method:"GET",url:"/api/index.php/blogs/"+c.blogId}).success(function(b){a.blog=b[0]}),b({method:"GET",url:"/api/index.php/blogs/"+c.blogId+"/posts"}).success(function(b){a.posts=b}),a.newBlog={},a.doCreate=function(a){var c={headers:{username:e.currentUser,token:e.token}};console.log(e.currentUser),console.log(e.token);var f=b.post("/api/index.php/newBlog",a,c);f.success(function(a,b,c,e){d.path("/blogs/"+a.idBlog),console.log(a)}).error(function(a,b,c,f){401==b?(window.alert("You are not logged in, please log in first."),e.$reset(),d.path("/login")):window.alert("Error with status: "+b)})},a.goToNewPost=function(){d.path("/blogs/"+a.blog.idBlog+"/newPost")},a.isLoggedIn=function(){return e.currentUser?!0:!1}}]),angular.module("blogApp").controller("BlogPostCtrl",["$scope","$http","$routeParams","$location",function(a,b,c,d){var e="/api/index.php/blogs/"+c.blogId+"/posts/"+c.postId;b({method:"GET",url:e}).success(function(b){a.blogPost=b[0]}),b({method:"GET",url:"/api/index.php/blogs/"+c.blogId}).success(function(b){a.blog=b[0]});var e="/api/index.php/blogs/"+c.blogId+"/posts/"+c.postId+"/comments/";b({method:"GET",url:e}).success(function(b){a.comments=b});var e="/api/index.php/blogs/"+c.blogId+"/posts/"+c.postId+"/images/";b({method:"GET",url:e}).success(function(b){a.images=b}),a.newComment={},a.doComment=function(e){e.postId=c.postId;var f=(new Date).toISOString().slice(0,19).replace("T"," ");e.DateTime=f;var g=b.post("/api/index.php/newComment",e);g.success(function(b,e,f,g){d.path("/blogs/"+c.blogId+"/posts/"+c.postId),a.newComment={},a.comments.push(b)})},a.direction="left",a.currentIndex=0,a.setCurrentSlideIndex=function(b){a.direction=b>a.currentIndex?"left":"right",a.currentIndex=b},a.isCurrentSlideIndex=function(b){return a.currentIndex===b},a.prevSlide=function(){a.direction="left",a.currentIndex=a.currentIndex<a.images.length-1?++a.currentIndex:0},a.nextSlide=function(){a.direction="right",a.currentIndex=a.currentIndex>0?--a.currentIndex:a.images.length-1}}]).animation(".slide-animation",function(){return{beforeAddClass:function(a,b,c){var d=a.scope();if("ng-hide"==b){var e=a.parent().width();"right"!==d.direction&&(e=-e),TweenMax.to(a,.5,{left:e,onComplete:c})}else c()},removeClass:function(a,b,c){var d=a.scope();if("ng-hide"==b){a.removeClass("ng-hide");var e=a.parent().width();"right"===d.direction&&(e=-e),TweenMax.fromTo(a,.5,{left:e},{left:0,onComplete:c})}else c()}}}),angular.module("blogApp").controller("NewBlogPostCtrl",["$scope","$http","$routeParams","$location","$localStorage",function(a,b,c,d,e){a.selected={},b({method:"GET",url:"/api/index.php/blogsbyuser/"+e.currentUser}).success(function(b){a.myBlogs=b}),a.newPost={},a.doCreate=function(f){if("undefined"==typeof a.selected.idBlog)window.alert("No blog selected, select blog first.");else if(0==a.images.length)window.alert("No image added, add at least one image!");else{a.newPost.blogId=a.selected.idBlog;var g=(new Date).toISOString().slice(0,19).replace("T"," ");a.newPost.dateTime=g;var h={headers:{username:e.currentUser,token:e.token}},i=b.post("/api/index.php/newPost",f,h);i.success(function(e,f,g,h){if(a.images.length>0){var i;for(i=0;i<a.images.length;++i)a.images[i].postId=e.idPost,b.post("/api/index.php/newImage",a.images[i])}d.path("/blogs/"+c.blogId+"/posts"+e.idPost)}).error(function(a,b,c,e){401==b?(window.alert("You are not logged in, please log in first."),d.path("/login")):window.alert(500==b?"Not your blog, FUCK OFF!!":"Error with status: "+b)})}},a.images=[],a.newImage={},a.addImage=function(b){a.images.push({name:a.newImage.name,link:a.newImage.link}),a.newImage.name="",a.newImage.link=""},a.deleteImage=function(b){a.images.splice(b,1)}}]),angular.module("blogApp").controller("AuthCtrl",["$scope","$http","$routeParams","$localStorage","$location",function(a,b,c,d,e){a.user={},a.doLogin=function(a){var c=b.post("/api/index.php/login",a);c.success(function(a,b,c,f){d.currentUser=a.username,d.token=a.token,e.path("/")}).error(function(a,b,c,d){window.alert("Wrong credentials, try again.")})},a.newUser={},a.doSignup=function(a){if(a.password==a.password2){var c=b.post("/api/index.php/signup",a);c.success(function(a,b,c,f){d.currentUser=a.username,d.token=a.token,e.path("/blogs/")}).error(function(a,b,c,d){window.alert("Something went wrong, try again.",a,b,c,d)})}else window.alert("Passwords are not equals, try again.")},a.logout=function(){d.currentUser={},d.token={},e.path("/")}}]);